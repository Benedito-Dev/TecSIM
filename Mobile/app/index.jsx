import React, { useEffect } from 'react';
import { AuthProvider } from './context/AuthContext';
import AppNavigator from './navigation/AppNavigator';
import { setupNotifications } from './services/notifications';

export default function App() {
  useEffect(() => {
    // Inicializar notifica√ß√µes quando o app abrir
    const initializeNotifications = async () => {
      try {
        console.log('üíß Inicializando lembretes de √°gua...');
        const token = await setupNotifications();
        
        if (token) {
          console.log('‚úÖ Lembretes de √°gua ativados!');
        } else {
          console.log('‚ö†Ô∏è Lembretes n√£o ativados');
        }
      } catch (error) {
        console.error('‚ùå Erro nos lembretes:', error);
      }
    };

    initializeNotifications();

    // üî• TESTE: Notifica√ß√£o em 3 segundos (REMOVA DEPOIS DO TESTE)
    setTimeout(async () => {
      try {
        console.log('üß™ Testando notifica√ß√£o em 3 segundos...');
        const { testWaterNotification } = await import('./services/notifications');
        const success = await testWaterNotification();
        
        if (success) {
          console.log('‚úÖ Teste de notifica√ß√£o enviado!');
        } else {
          console.log('‚ùå Teste de notifica√ß√£o falhou');
        }
      } catch (error) {
        console.error('‚ùå Erro no teste:', error);
      }
    }, 3000); // ‚è∞ 3 segundos

  }, []);

  return (
    <AuthProvider>
      <AppNavigator />
    </AuthProvider>
  );
}