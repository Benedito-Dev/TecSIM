services:
  backend:
    build: ./backend
    container_name: backend
    ports:
      - "3000:3000"
    environment:
      POSTGRES_URI: ${POSTGRES_URI}
      DATABASE_URL_MONGO: ${MONGO_URI}
      JWT_SECRET: ${JWT_SECRET}

  frontend:
    build: ./mobile
    container_name: tecsim-frontend
    ports:
      - "8081:8081"   # Metro Bundler
      - "19000:19000" # Expo Go (LAN)
      - "19001:19001" # Debugger
      - "19002:19002" # Expo DevTools (web)
    volumes:
      - ./mobile:/app
      - /app/node_modules
    environment:
      API_URL: http://backend:3000
    stdin_open: true
    tty: true
    depends_on:
      - backend

  db-init:
    build: ./backend
    container_name: db-init
    environment:
      POSTGRES_URI: ${POSTGRES_URI}
      DATABASE_URL_MONGO: ${MONGO_URI}
    depends_on:
      - backend
    command: ["node", "db/dbinit.js"]

volumes:
  postgres_data:
